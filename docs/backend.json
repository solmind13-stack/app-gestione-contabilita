
{
  "entities": {
    "Movement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Movement",
      "type": "object",
      "description": "Represents a financial transaction or bank movement.",
      "properties": {
        "id": { "type": "string" },
        "year": { "type": "number" },
        "date": { "type": "string", "format": "date-time" },
        "description": { "type": "string" },
        "category": { "type": "string" },
        "subCategory": { "type": "string" },
        "grossIncome": { "type": "number" },
        "grossExpenses": { "type": "number" },
        "vatPercentage": { "type": "number" },
        "netIncome": { "type": "number" },
        "vatIncome": { "type": "number" },
        "netExpenses": { "type": "number" },
        "vatExpense": { "type": "number" },
        "account": { "type": "string" },
        "operator": { "type": "string" },
        "paymentMethod": { "type": "string" },
        "notes": { "type": "string" },
        "societa": { "type": "string" },
        "createdBy": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["ok", "manual_review"] }
      },
      "required": ["id", "year", "date", "description", "category", "societa", "createdBy", "createdAt", "updatedAt"]
    },
    "Deadline": {
      "title": "Deadline",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "year": { "type": "number" },
        "dueDate": { "type": "string", "format": "date-time" },
        "description": { "type": "string" },
        "category": { "type": "string" },
        "expectedAmount": { "type": "number" },
        "paidAmount": { "type": "number" },
        "status": { "type": "string" },
        "societa": { "type": "string" }
      }
    },
    "EntityScore": {
      "title": "EntityScore",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "societa": { "type": "string" },
        "userId": { "type": "string" },
        "entityName": { "type": "string" },
        "entityType": { "type": "string", "enum": ["client", "supplier"] },
        "reliabilityScore": { "type": "number" },
        "averagePaymentDelay": { "type": "number" },
        "totalTransactions": { "type": "number" },
        "lastUpdated": { "type": "string", "format": "date-time" }
      }
    },
    "CashFlowProjection": {
      "title": "CashFlowProjection",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "societa": { "type": "string" },
        "userId": { "type": "string" },
        "scenarioType": { "type": "string", "enum": ["optimistic", "realistic", "pessimistic"] },
        "confidenceScore": { "type": "number" },
        "generatedAt": { "type": "string", "format": "date-time" },
        "weeklyProjections": { "type": "array" }
      }
    },
    "LiquidityAlert": {
      "title": "LiquidityAlert",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "societa": { "type": "string" },
        "userId": { "type": "string" },
        "status": { "type": "string", "enum": ["green", "yellow", "red"] },
        "message": { "type": "string" },
        "projectedDate": { "type": "string", "format": "date-time" },
        "projectedBalance": { "type": "number" },
        "triggeredAt": { "type": "string", "format": "date-time" },
        "acknowledged": { "type": "boolean" }
      }
    },
    "SeasonalAnalysis": {
      "title": "SeasonalAnalysis",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "societa": { "type": "string" },
        "userId": { "type": "string" },
        "patterns": { "type": "array" },
        "narrative": { "type": "string" },
        "generatedAt": { "type": "string", "format": "date-time" },
        "monthsAnalyzed": { "type": "number" }
      }
    },
    "DataAuditLog": {
      "title": "DataAuditLog",
      "type": "object",
      "description": "Logs every change made to financial data documents.",
      "properties": {
        "id": { "type": "string" },
        "societa": { "type": "string" },
        "userId": { "type": "string" },
        "collection": { "type": "string" },
        "documentId": { "type": "string" },
        "action": { "type": "string", "enum": ["create", "update", "delete"] },
        "previousData": { "type": "object" },
        "newData": { "type": "object" },
        "changedFields": { "type": "array", "items": { "type": "string" } },
        "timestamp": { "type": "string", "format": "date-time" },
        "source": { "type": "string", "enum": ["manual", "import", "ai_suggestion", "bulk_operation"] }
      }
    }
  },
  "firestore": {
    "structure": [
      {
        "path": "/movements/{movementId}",
        "definition": { "entityName": "Movement" }
      },
      {
        "path": "/deadlines/{deadlineId}",
        "definition": { "entityName": "Deadline" }
      },
      {
        "path": "/users/{userId}/entityScores/{scoreId}",
        "definition": { "entityName": "EntityScore" }
      },
      {
        "path": "/cashFlowProjections/{projectionId}",
        "definition": { "entityName": "CashFlowProjection" }
      },
      {
        "path": "/liquidityAlerts/{alertId}",
        "definition": { "entityName": "LiquidityAlert" }
      },
      {
        "path": "/users/{userId}/seasonalPatterns/{analysisId}",
        "definition": { "entityName": "SeasonalAnalysis" }
      },
      {
        "path": "/dataAuditLog/{logId}",
        "definition": { "entityName": "DataAuditLog" }
      }
    ]
  }
}
